import { findContentById } from '@src/core/utils/finder'
import _ from 'lodash'
import { baseStatsObject, StatsObject } from '../../baseConstant'
import { Stats } from '@src/domain/genshin/constant'

const Albedo = (c: number, a: number) => {
  const maxFatalReckoning = 4

  const content = [
    {
      type: 'toggle',
      id: 'calciteMight',
      text: `Calcite Might`,
      title: 'A1: Calcite Might',
      content: `Transient Blossoms generated by Abiogenesis: Solar Isotoma deal 25% more DMG to opponents whose HP is below 50%.`,
      show: a >= 1,
      default: true,
    },
    {
      type: 'number',
      id: 'fatalReckoningStacks',
      text: `Fatal Reckoning Stacks`,
      title: 'C2: Flower of Eden',
      content: `Transient Blossoms generated by Abiogenesis: Solar Isotoma grant Albedo Fatal Reckoning for 30s:
      - Unleashing Rite of Progeniture: Tectonic Tide consumes all stacks of Fatal Reckoning. Each stack of Fatal Reckoning consumed increases the DMG dealt by Fatal Blossoms and Rite of Progeniture: Tectonic Tide's burst DMG by 30% of Albedo's DEF.
      - This effect stacks up to 4 times.`,
      show: c >= 2,
      min: 0,
      max: maxFatalReckoning,
      default: maxFatalReckoning,
    },
    {
      type: 'toggle',
      id: 'dustOfPurification',
      text: `Dust of Purification`,
      title: 'C6: Dust of Purification',
      content: `Active party members within the Solar Isotoma field who are protected by a shield created by Crystallize have their DMG increased by 17%.`,
      show: c >= 6,
      default: true,
    },
  ]

  const teammateContent = [
    {
      type: 'toggle',
      id: 'homuncularNature',
      text: `Homuncular Nature`,
      title: 'A4: Calcite Might',
      content: `Using Rite of Progeniture: Tectonic Tide increases the Elemental Mastery of nearby party members by 125 for 10s.`,
      show: a >= 4,
      default: true,
    },
    {
      type: 'toggle',
      id: 'descentOfDivinity',
      text: `Descent of Divinity`,
      title: 'C4: Descent of Divinity',
      content: `Active party members within the Solar Isotoma field have their Plunging Attack DMG increased by 30%.`,
      show: c >= 4,
      default: true,
    },
    findContentById(content, 'dustOfPurification'),
  ]

  return {
    content,
    teammateContent,
    preCompute: (form: Record<string, any>) => {
      const base = _.cloneDeep(baseStatsObject)

      base.BURST_DMG += 0.3 * form.fatalReckoningStacks
    },
    preComputeShared: (base: StatsObject, form: Record<string, any>) => {
      base[Stats.ALL_DMG] += 0.17 * form.dustOfPurification
    },
  }
}

export default Albedo
